# 공유 기능 요구사항 정리 (최종)

## 📋 사용 시나리오

### 전체 흐름
```
1. 판매자(나)가 구매자에게 검사 링크 제공
2. 구매자가 검사를 완료
3. 구매자가 "결과 공유하기" 버튼 클릭
4. 결과가 Supabase에 저장되고 공유 링크 생성
5. 구매자가 공유 링크를 판매자에게 전달
6. 판매자가 공유 링크로 접속하여 구매자의 결과 확인 (읽기 전용)
```

## ✅ 핵심 요구사항

### 1. 결과 저장
- ✅ **누구나** 결과를 Supabase에 저장 가능 (로그인 불필요)
- ✅ 저장 시 고유한 `share_id` 생성
- ✅ 저장된 결과는 Supabase에 영구 보관

### 2. 공유 링크 생성
- ✅ 저장 후 공유 링크 자동 생성
- ✅ 링크 형식: `https://domain.com?share={share_id}`
- ✅ 구매자가 링크를 복사하여 판매자에게 전달

### 3. 공유 링크 접속 (읽기 전용)
- ✅ 공유 링크로 접속한 사람은 **결과를 읽기만 가능**
- ✅ Supabase에서 `share_id`로 결과 조회
- ✅ 수정/삭제 불가능 (읽기 전용)
- ✅ "공유된 결과" 표시

## 🔐 보안 정책

### Supabase RLS (Row Level Security) 정책

#### 1. INSERT (저장) 정책
- **누구나** 결과를 저장할 수 있음 (인증 불필요)
- `WITH CHECK (true)` - 모든 사용자 허용

#### 2. SELECT (조회) 정책
- **공유 링크로 접속한 경우**: `share_id`를 알고 있으면 누구나 읽기 가능
- `USING (true)` - 모든 사용자 허용

#### 3. UPDATE/DELETE 정책
- **공유 링크로 접속한 사용자는 수정/삭제 불가**
- UPDATE/DELETE 정책은 설정하지 않음 (기본적으로 차단)

## 📊 데이터 흐름

### 시나리오 1: 구매자가 결과 저장 및 공유
```
1. 구매자가 진단 완료
2. "결과 공유하기" 버튼 클릭
3. 결과 데이터 준비
4. Supabase에 결과 저장 (인증 불필요)
5. share_id 생성 및 반환
6. 공유 링크 생성: ?share={share_id}
7. 링크 복사 기능 제공
8. 구매자가 링크를 판매자에게 전달
```

### 시나리오 2: 판매자가 공유 링크로 결과 확인
```
1. 판매자가 공유 링크 접속: ?share={share_id}
2. URL에서 share_id 추출
3. Supabase에서 share_id로 결과 조회
4. 결과 데이터 로드
5. 읽기 전용 화면 표시
6. 수정/삭제 버튼 없음
```

## 🗄️ 데이터베이스 구조

### 테이블: `career_results`

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| `id` | BIGSERIAL | 기본 키 (자동 증가) |
| `share_id` | TEXT UNIQUE | 공유 링크에 사용되는 고유 ID |
| `scores` | JSONB | RIASEC 유형별 점수 |
| `top_type` | TEXT | 최고 점수 유형 (R, I, A, S, E, C) |
| `selected_keywords` | TEXT[] | 선택된 모든 키워드 배열 |
| `top_keywords` | TEXT[] | 최종 선택된 Top 3 키워드 배열 |
| `selected_values` | TEXT[] | 선택된 가치관 배열 |
| `created_at` | TIMESTAMPTZ | 생성 시간 |

### 인덱스
- `share_id`에 UNIQUE 인덱스 (조회 성능 및 중복 방지)

## 🎨 UI/UX 고려사항

### 구매자 화면 (결과 저장)
- "결과 공유하기" 버튼
- 저장 중 로딩 표시
- 공유 링크 생성 후 링크 표시 및 복사 버튼
- "링크를 판매자에게 전달해주세요" 안내 문구

### 판매자 화면 (공유 링크 접속)
- "공유된 결과" 배지 표시
- 읽기 전용 표시
- 수정/삭제 버튼 없음
- 결과 내용 전체 표시
- "나도 진단하기" 버튼 제공 (선택사항)

## ✅ 구현 체크리스트

- [ ] Supabase 테이블 생성 (user_id 불필요)
- [ ] RLS 정책 설정 (INSERT: 모두 허용, SELECT: 모두 허용)
- [ ] 결과 저장 로직 (인증 없이)
- [ ] share_id 생성 로직
- [ ] 공유 링크 생성
- [ ] 공유 링크 접속 시 결과 조회
- [ ] 읽기 전용 UI 구현
- [ ] 에러 처리 (링크 만료, 잘못된 링크 등)

## 🚫 제외 사항

- ❌ 로그인/인증 기능 (불필요)
- ❌ 사용자 계정 관리
- ❌ 결과 수정 기능 (공유 링크로 접속한 경우)
- ❌ 결과 삭제 기능 (공유 링크로 접속한 경우)
- ❌ user_id 컬럼 (누가 저장했는지 추적 불필요)

## 📝 요약

**핵심**: 
- 누구나 결과 저장 가능 (로그인 불필요)
- 공유 링크를 받은 사람은 읽기만 가능
- Supabase에 결과 영구 저장
- 간단하고 직관적인 흐름
